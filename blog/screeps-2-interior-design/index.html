<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Screeps #2: Interior Design | Ben Bartlett</title> <meta name="author" content="Ben Bartlett"> <meta name="description" content=""> <meta name="keywords" content="nanophotonics, quantum computing, quantum information, quantum optics, machine learning, photonic computing, optical computing, quantum optics"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/icon_small.png?8f6d278252418bd2ad8a183dda2f5184"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://bencbartlett.github.io/blog/screeps-2-interior-design/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Ben </span><span class="font-weight-bold">Bartlett</span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/software/">Software</a> </li> <li class="nav-item "> <a class="nav-link" href="/math-animations/">Math Animations</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Screeps #2: Interior Design</h1> <p class="post-meta">February 6, 2018</p> <p class="post-tags"> <a href="/blog/2018"> <i class="fas fa-calendar fa-sm"></i> 2018 </a>   ·   <a href="/blog/tag/screeps"> <i class="fas fa-hashtag fa-sm"></i> screeps</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Now that the dust has settled following the recent <a href="https://bencbartlett.wordpress.com/2018/01/15/screeps-1-overlord-overload/" rel="external nofollow noopener" target="_blank">massive rewrite of my AI</a>, I’ve been able to turn my attention to adding more features to Overmind. Here’s a few of the things I’ve been working on…</p> <h1 id="room-planning">Room planning</h1> <p>Overmind finally hired an interior decorator! I’ve been developing a semi-automatic room planning system for the last month or so, beginning slightly before the rewrite. I’m a little OCD about room layouts and aesthetics, so I wanted to design a system that could be fully automated but also would allow for user input when choosing the layout. I’ll discuss it in more detail below, but here’s a video of it in action:</p> <figure> <video src="/assets/video/Overmind_base_planner_h265.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" autoplay="" controls="" loop=""></video> </figure> <p>Each colony now includes a <a href="https://github.com/bencbartlett/Overmind/blob/8a9ca323091f15c56bb55957828cfc88da8aa4e2/src/roomPlanner/RoomPlanner.ts" rel="external nofollow noopener" target="_blank">RoomPlanner</a>, referenced as <code class="language-plaintext highlighter-rouge">colony.roomPlanner</code>, which is responsible for generating a room layout and placing construction sites as needed to build the layout as the colony level increases. When you set <code class="language-plaintext highlighter-rouge">colony.roomPlanner.active = true</code> (I’m working on adding a set of console commands to make this simpler), the RoomPlanner opens a new planning session for you. The planned layout is drawn using RoomVisuals each tick while the session is active.</p> <p>You can place flags of certain color codes (white/* is reserved for this) to place different types of HiveClusters around the room. For example, placing a white/green flag will place a hatchery, while a white/blue flag will place a command center. Activating a planning session will display a list of flag commands in the console. The cluster layouts are pre-designed using the text output from <a href="https://screeps.dissi.me/buildingplanner/" rel="external nofollow noopener" target="_blank">Dissi’s building planner</a> and the layouts for each RCL are stored in a large JSON object (example: <a href="https://github.com/bencbartlett/Overmind/blob/master/src/roomPlanner/layouts/hatchery.ts" rel="external nofollow noopener" target="_blank">hatchery</a>) containing the layouts and a bit of extra metadata. Placing a flag translates the layout to the appropriate location (set by the object which instantiates the corresponding hive cluster) and you can change <code class="language-plaintext highlighter-rouge">flag.memory.rotation</code> to set the rotation of the cluster. Some clusters, like mining sites, don’t require manual placement since their position can be inferred.</p> <p>The planner then computes the routes to connect the clusters appropriately with roads using my <a href="https://github.com/bencbartlett/Overmind/blob/master/src/pathing/pathing.ts" rel="external nofollow noopener" target="_blank">Pathing</a> module (which interfaces heavily with Traveler), placing routes from the commandCenter to the hatchery, upgradeSite, and each miningSite. When <code class="language-plaintext highlighter-rouge">Pathing.routeRoadPath()</code> is called, it computes the shortest passable path between two locations, treating positions where a future building is planned as obstacles, and ignoring terrain values, such that every position has a cost of 2 in the pathfinder CostMatrix.</p> <p>One of the cooler features I’ve added to the RoomPlanner is the ability to place routing hints with a white/white flag. These hints change the cost of the square they are placed on from 2 to 1, such that roads will preferentially be routed through the flag position, but only if the possible path lengths are degenerate. If the path planned using hints is longer than the shortest possible path, the errant path is drawn in red and a warning is displayed. This allows me to generate paths that would consistently satisfy functionality (being as short as possible) and aesthetics (no excessive zig-zags, merging nicely, etc.).</p> <p>When you’re happy with the planned layout and the RoomPlanner is also satisfied with it (requiring that a hatchery, a commandCenter, and an upgradeSite have been placed and that all planned building placements are valid), you can call <code class="language-plaintext highlighter-rouge">colony.roomPlanner.finalize()</code> to end your planning session and write everything to memory. This generates room plans for each RCL and serializes them into memory. Once the plan has been finalized, every $latex N$ ticks, the planner will check if there are structures and roads which need to be built and will place construction sites accordingly.</p> <p>Upon ending a session, the planner also removes all planning flags (white/*) you have placed across the colony, after saving the locations and types of them in its memory. You can reopen your session at a later time and the planner will restore the flags from the previous session, allowing you to easily modify the room plan in the future.</p> <h1 id="brave-new-world-shard">Brave new <del>world</del> shard</h1> <p>After fixing a few final bugs in my AI (including one <a href="https://screeps.com/forum/topic/2084/creep-spawning-false-and-creep-tickstolive-undefined-on-private-server" rel="external nofollow noopener" target="_blank">incredibly frustrating one</a> due to a bug in the private servers where overlords would occasionally spawn one additional creep beyond what was needed, depending on the state of the Hatchery’s production queue), I decided I’m finally ready to deploy the new version to the public servers and respawn to a faster-ticking shard.</p> <p>Earlier today, my Screeps abandoned <a href="https://screeps.com/a/#!/map/shard0?pos=-15.61,-87.714" rel="external nofollow noopener" target="_blank">their ancestral home</a> and respawned to <a href="https://screeps.com/a/#!/room/shard2/E5S47" rel="external nofollow noopener" target="_blank">shard2, E5S47</a>. Feel free to check in if you’re interested in following my progress.</p> <h1 id="organs-for-sale">Organs for sale?</h1> <p>I’m very close to a 1.0 release of Overmind, and an idea I’ve been tossing around recently is making a separate <code class="language-plaintext highlighter-rouge">overmind-components</code> repository on Github to host some of the more polished parts of my AI as drag-and-drop plugins. I’ve spent a disproportionately large amount of time writing a clean framework to work with for Screeps (at the expense of developing features), and I’ve had several people message me on Slack/Reddit to ask for help integrating parts of my code into their AI’s, so I think the demand could definitely be there.</p> <p>To clarify, I would only be exporting “framework” code, such as my <code class="language-plaintext highlighter-rouge">Task</code> system, which can simplify the syntax and complexity of writing decision trees for creeps, rather than “feature” code, which is stuff like combat, mining, and processing minerals that people should write for themselves.</p> <p>If you have thoughts on this or would be interested in helping me beta test these plugins, leave a comment here, in the <a href="https://www.reddit.com/r/screeps/comments/7vkr3n/screeps_2_interior_design/" rel="external nofollow noopener" target="_blank">Reddit post</a>, in the <a href="https://screeps.slack.com/messages/overmind" rel="external nofollow noopener" target="_blank">#overmind</a> Slack channel, or send me a DM <a href="https://screeps.slack.com/messages/muon" rel="external nofollow noopener" target="_blank">@muon</a>. (I also accept carrier pigeons and, if you live near Palo Alto, smoke signals.)</p> </div> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> © Copyright 2023 Ben Bartlett. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>